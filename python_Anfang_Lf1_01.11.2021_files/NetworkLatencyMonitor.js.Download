function TrackNetworkLatency(a){(new NetworkLatencyMonitor({measurePeriod:864E5,networkLatencyPingUrl:a.networkLatencyPingUrl,networkLatencySaveMeasureUrl:a.networkLatencySaveMeasureUrl})).Start(15E3)}function NetworkLatencyMonitor(a){this._measurePeriods=a.measurePeriod;this._timerEndTime=this._timerStartTime=null;this._cookieKeyNetworkLatency="trackNetworkLatency";this._urlNetworkLatencyPing=a.networkLatencyPingUrl;this._urlNetworkLatencySaveMeasure=a.networkLatencySaveMeasureUrl}
NetworkLatencyMonitor.prototype.Start=function(a){window.setTimeout(this.createHandler(this,this.Measure),a)};NetworkLatencyMonitor.prototype.Measure=function(){this.getNowTime()-this.getTimeOfPrevMeasure()>=this._measurePeriods&&this.sendPingRequest()};NetworkLatencyMonitor.prototype.sendPingRequest=function(){this.startTimer();this.callServer(this._urlNetworkLatencyPing,{},this.pingRequestOnSuccess)};
NetworkLatencyMonitor.prototype.sendSaveMeasureRequest=function(a){this.callServer(this._urlNetworkLatencySaveMeasure,{NetworkLatency:a},this.saveMeasureOnSuccess)};NetworkLatencyMonitor.prototype.pingRequestOnSuccess=function(){this.stopTimer();var a=this.getTimerValue();this.sendSaveMeasureRequest(a)};NetworkLatencyMonitor.prototype.saveMeasureOnSuccess=function(){this.setTimeOfPrevMeasure(this.getNowTime());this.Start(this._measurePeriods)};
NetworkLatencyMonitor.prototype.getTimeOfPrevMeasure=function(){var a=this.readCookie(this._cookieKeyNetworkLatency);return null!=a?a:0};NetworkLatencyMonitor.prototype.setTimeOfPrevMeasure=function(a){var c=this.getNowTime()+this._measurePeriods;this.setCookie(this._cookieKeyNetworkLatency,a,c)};NetworkLatencyMonitor.prototype.setCookie=function(a,c,d){var b="";d&&(b=new Date,b.setTime(d),b="; expires="+b.toGMTString());document.cookie=a+"="+c+b+"; path=/"};
NetworkLatencyMonitor.prototype.readCookie=function(a){a+="=";for(var c=document.cookie.split(";"),d=0;d<c.length;d++){for(var b=c[d];" "==b.charAt(0);)b=b.substring(1,b.length);if(0==b.indexOf(a))return b.substring(a.length,b.length)}return null};NetworkLatencyMonitor.prototype.startTimer=function(){this._timerStartTime=new Date};NetworkLatencyMonitor.prototype.stopTimer=function(){this._timerEndTime=new Date};
NetworkLatencyMonitor.prototype.getTimerValue=function(){return this._timerEndTime.getTime()-this._timerStartTime.getTime()};NetworkLatencyMonitor.prototype.callServer=function(a,c,d){CCL.CommonFunctions.safeAjaxPost({url:a,data:c}).done(this.createHandler(this,d))};NetworkLatencyMonitor.prototype.createHandler=function(a,c){return function(){return c.apply(a,arguments)}};NetworkLatencyMonitor.prototype.getNowTime=function(){return(new Date).getTime()};
