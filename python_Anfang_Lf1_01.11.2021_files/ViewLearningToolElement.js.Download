function ViewLearningToolElement(a,l,h){function m(){CCL.CommonFunctions.safeAjaxPost({url:a.webMethods.checkCopyStatus.replace("{elementId}",a.elementId)}).done(function(b){b.status!=a.enums.copyStatus.inProgress&&(clearInterval(k),$("#"+a.controls.progressPanel).hide(),g().toggleCloseLink(!1),b.status==a.enums.copyStatus.completed?a.isCopy||g().showMessage(a.enums.feedbackType.information,a.terms.creatingNewVersionSucceededFeedback):b.status==a.enums.copyStatus.failed?a.isCopy?g().showMessage(a.enums.feedbackType.warning,
a.terms.creatingCopyFailedFeedback):g().showMessage(a.enums.feedbackType.warning,a.terms.creatingNewVersionFailedFeedback):b.status!=a.enums.copyStatus.none||a.isCopy?g().showMessage(a.enums.feedbackType.information,a.terms.copyingStatusChangedFeedback):g().showMessage(a.enums.feedbackType.information,a.terms.creatingNewVersionSucceededFeedback))}).error(function(){clearInterval(k)})}function n(b){var e=$("."+a.cssClasses.pageFunctionDependsFromElementActivation);e&&e.length&&(e.toggleHyperlink(b),
e.toggleClass(a.cssClasses.inactive,!b))}function t(){return $("#"+a.controls.pageFunctionsCogwheelMenu+" ul li").filter(function(){return"none"!==$(this).css("display")}).length}function p(b,e){var d=""===b?0:b;CCL.CommonFunctions.safeAjaxPost({url:a.webMethods.rate.replace("{elementId}",a.elementId),data:{rate:d,comment:e}}).done(function(b){var e=$("#"+a.controls.currentRateHidden),c=e.val()!=d;e.val(d);b&&($("#"+a.controls.currentCommentHidden).val(b.comment),$("#"+a.controls.commentInput).val(b.comment),
b.title&&($("h2."+a.cssClasses.reviewTitleLink).text(b.title),$("a."+a.cssClasses.reviewTitleLink).text(b.title)));c&&($(document).trigger(a.showRateEventName,d),$(document).trigger(a.rateSuccessEventName,d))}).fail(function(b){alert(a.terms.notAllowedToRateMessage);$("#"+a.controls.rateHidden).rateFeedback.hide()})}var c=this,k,q=$("#"+a.controls.printLink),r=$("#"+a.controls.pageFunctionsCogwheel);(new CCL.AutoIframeResizer({extensionIframeId:a.controls.extensionIframe,extensionContentId:a.controls.extensionContent,
iosScrollFixClass:a.cssClasses.iosScrollFix,resizeIframeWidth:a.resizeExtensionIframeWidth})).init();var u=new ItslearningWeb.Onboarding.ViewLearningToolElement.PostMessageDispatcher,f=$("#"+a.controls.extensionIframe);f&&f[0].contentWindow&&u.init(a.onboardingServiceUrl,f,a);CommonFunctions.attachPostMessageEventListener($(window),a.refreshTreeMenuMessageName,function(){var b;(b=window.parent)&&window!=b&&CommonFunctions.makePostMessageCall(b,{messageName:a.refreshTreeMenuMessageName,elementId:a.elementId,
folderId:a.folderId})});CommonFunctions.attachPostMessageEventListener($(window),a.refreshElementFrameMessageName,function(){window.location.reload(!0)});$("#"+a.controls.copyLink).on("click",function(b){a.isShared?($("#"+a.controls.linkText).val($("#"+a.controls.embedUrlHidden).val()),$("#"+a.controls.embedCodeText).val($("#"+a.controls.embedCodeHidden).val()),window[a.controls.linkOrEmbedDialog].openDialog()):(b.preventDefault(),b.stopPropagation())});CommonFunctions.attachPostMessageEventListener($(window),
CommonWindowMessages.MessageNames.openPersonProfileCard,function(a){document.showProfileCard(a.extendedData)});CommonFunctions.attachPostMessageEventListener($(window),CommonWindowMessages.MessageNames.backToPreviousPage,function(){document.location.replace(a.backPageUrl)});CommonFunctions.attachPostMessageEventListener($(window),CommonWindowMessages.MessageNames.cloudFilePermissionError,function(){window.location.replace(a.cloudFilePermissionErrorUrl)});CommonFunctions.attachPostMessageEventListener($(window),
CommonWindowMessages.MessageNames.askExtensionParentFrameWhetherTopFrameExists,function(){var a=!1;try{a=window.self!==window.itslTop}catch(e){}f&&f[0].contentWindow&&a&&(a=new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.replyToExtensionFrameWhenTopFrameExists),CCL.CommonFunctions.makePostMessageCall(f[0].contentWindow,a))});CommonFunctions.attachPostMessageEventListener($(window),CommonWindowMessages.MessageNames.scrollToTop,function(){$(window).scrollTop(0)});$("#"+
a.controls.rateHidden).on("change",function(){var a=$(this).val();p(a,null)});h&&h();if(a.canEdit){a.copyStatus==a.enums.copyStatus.inProgress&&(k=setInterval(m,1E3));h=new ItslearningWeb.Controls.ElementTitleEditor($("#"+a.controls.titleLabel),a.elementTitleEditorClientSettings,a.elementId,a.folderId);if(l)$(h).on("change",l);$(h).on("change",function(a){if(f&&f[0].contentWindow){var b=new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionTitleUpdated);CCL.CommonFunctions.makePostMessageCallWithData(f[0].contentWindow,
b,{newTitle:a})}})}(function(){CCL.CommonFunctions.attachPostMessageEventListener($(window),CommonWindowMessages.MessageNames.elementAddedToYourCollection,function(){var b=window.location.href.split("#")[0];window.location.href=b.setQueryStringParameter(a.addedParam,(!0).toString())})})();(function(){CommonFunctions.attachPostMessageEventListener($(window),CommonWindowMessages.MessageNames.changePrintFeatureVisibility,function(a){a.visible?q.show():q.hide();0<t()?r.show():r.hide()})})();CCL.IframeContentHeightReporter.attachExtensionContentOpenedListenerForIframe(a.controls.extensionIframe,
a.resizeExtensionIframeWidth);n(a.isActive);c.closeManageRubricDialog=function(){var b=$("#"+a.rubricDialogClientInstanceName).find("iframe").get(0).contentWindow;CCL.CommonFunctions.makePostMessageCall(b,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.submitIframe))};c.showCopyConfirmation=function(b){$.alerts.okButton=b;$.alerts.cancelButton=a.terms.cancel;jConfirm(a.terms.startCopyingConfirmation,a.terms.pleaseConfirm,function(b){b&&CCL.CommonFunctions.safeAjaxPost({url:a.webMethods.startCopying.replace("{elementId}",
a.elementId)}).done(function(b){b.success&&(a.isCopy=!1,c.showProgressMessage(a.terms.creatingNewVersionProgressFeedback),k=setInterval(m,1E3))})})};c.showProgressMessage=function(b){$("#"+a.controls.progressPanel).show();$("#"+a.controls.createNewVersionLinkContainer).hide();$("#"+a.controls.editOriginalLinkContainer).hide();$("#"+a.controls.ratingPanel).hide();$("#"+a.controls.progressLabel).text(b);g().hide(!1)};c.flushCopyStatus=function(){CCL.CommonFunctions.safeAjaxPost({url:a.webMethods.flushCopyStatus.replace("{elementId}",
a.elementId)})};c.openReviewDialog=function(){$("#"+a.controls.commentInput).focus()};c.saveReview=function(){var b=$("#"+a.controls.rateHiddenInDialog).val();p(b,$("#"+a.controls.commentInput).val())};c.cancelReview=function(){$("#"+a.controls.commentInput).val($("#"+a.controls.currentCommentHidden).val());var b=$("#"+a.controls.currentRateHidden).val();$(document).trigger(a.showRateEventName,b)};c.printContentFrame=function(){var b=$("#"+a.controls.extensionIframe)[0];if(b&&b.contentWindow){var e=
$("."+a.cssClasses.title).text(),c=$("."+a.cssClasses.container)[0].outerHTML;CommonFunctions.makePostMessageCall(b.contentWindow,{messageName:CommonWindowMessages.MessageNames.extensionPrintContentFrame,headerText:e,headerHtml:c})}return!1};c.notifyAboutChanges=function(){$.alerts.okButton=a.terms.ok;$.alerts.cancelButton=a.terms.cancel;jConfirm(a.terms.notifyAboutChangesConfirmation,a.terms.pleaseConfirm,function(b){b&&CCL.CommonFunctions.safeAjaxPost({url:a.webMethods.notifyAboutChanges,data:{elementId:a.elementId}}).fail(CCL.CommonFunctions.alertAjaxError)});
return!1};c.sendElementReminders=function(){$.alerts.okButton=a.terms.sendRemindersYes;$.alerts.cancelButton=a.terms.cancel;jConfirm(a.terms.sendRemindersDetails,a.terms.sendReminders,function(b){b&&CCL.CommonFunctions.safeAjaxPost({url:a.webMethods.sendReminders,data:{elementId:a.elementId}}).fail(CCL.CommonFunctions.alertAjaxError)});return!1};var g=function(){return window[a.copyStatusFeedbackInstanceName]};c.copyToClipboardOk=function(b){var c=null,d=null;"CopyLink"==b?(c=$("#"+a.controls.linkText),
d=$("#"+a.controls.copyLinkToClipboardOkIcon)):(c=$("#"+a.controls.embedCodeText),d=$("#"+a.controls.copyEmbedCodeToClipboardOkIcon));b=d.css("width");d.parent().css("width",b);(function(a){var b=document.createElement("input");b.style.position="fixed";b.style.opacity=0;b.value=a;document.body.appendChild(b);b.select();document.execCommand("copy");document.body.removeChild(b)})(c.val());d.prev().hide();d.fadeIn(500);setTimeout(function(){d.hide().prev().fadeIn(400)},1E3)};c.changePageFunctionsState=
function(a){n(a)}};
